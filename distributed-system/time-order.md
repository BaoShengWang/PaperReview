# 1. 什么是分布式系统

 分布式系统是一个强连通图，顶点是process，边是通信管道channel。

* 进程只能可能到自己内部的状态，不能看到其他进程的状态，进程之间通过消息通信

* 没有全局锁,没有全局锁，因此不能对分布式系统发生的事件进行一个全局排序。
* 消息不保序：process 1向process2.顺序发送message 1，message 2，message 3，process 2接受的顺序可能是message 3，message2，message1
* 消息延迟未知：每一个消息的延迟没有上届，可能几毫米，几秒，几分钟都有可能。
* 消息传递是异步的：process1发送message给process2之后立刻返回继续处理接下来的工作，而不用等待process2完成。



> **现实世界中的分布式系统非常庞大而复杂，不便于理论分析。为了方便进行理论分析，需要对分布式系统进行一个抽象，形成一个system model。所谓model，就是将一个复杂的事物，不断的去除次要的东西，而抽象出最本质的事务来进行分析。例如在上面的分布式系统模型中，将分布式系统抽象成process，channel组成的强连通图，而不必关系process到底是什么东西，它可以是线程，进程，甚至可以是一个系统，channel可以是tcp，管道，内存映射。**



上面的定义是从一个非常宏观的角度来看分布式系统的，下面我们从执行的角度来看分布式系统。

# 2. 分布式计算:理想和现实

"分布式计算"这个词太过于抽象了，不易于形式化处理。因此研究分布式计算的第一个步骤就是先给出一个严格的形式化定义。

理想中的分布式计算是一个全序集，这个序是按照事件发生的时间来排序的。但是现实中的分布式计算是一个偏序集，这个序是又lamport定义的happen-before序，也叫做causal precedence序。



f=\(E,&lt;\),其中E是事件集合，&lt;是E上的一个全序。

>

> 我们来看一下上面这个定义都说了哪些东西。其实说白了，就是按照事件的发生时间排成一个序列。

> **我们可以发现，这个事件序列是一个全序集：对于该事件序列中的任何两个事件，都可以知道他们发生的顺序。**
>
> **全序集非常好用，但是遗憾的是，上面这个全序集只能理论上存在，在一个真实的分布式系统中，很难得到全序集，原因是，在分布式系统中，很难得到一个可靠的全局时钟。**



上面说了理想中的分布式计算，接下来看看现实中的分布式计算是什么样的。

   f=\(E,&lt;\),其中E是事件集合，&lt;是E上的一个偏序。





何为事件。

我们说过，每一个process之间是独立工作的，虽然process之间有通过消息传递协调执行，但是消息依然是异步的。我们可以把整个分布式系统中执行的操作抽象成事件event，有的事件可能会改变process内部的状态\(将状态100改变成120\)，这种事件叫做internal event，有的事件可能会向其他process发送一个消息，这种事件叫做send event，类似的还有receive event。

整个分布式系统中只有以上三种事件：internal event，send event，receive event。



**event是原子的，一个事件不会看到另一个事件的中间结果，从这一点来看，事件可以认为是瞬时的，没有持续事件，事件不会有重叠，事件是一个接着一个运行的。这个抽象非常好用，例如在space-time diagram图时，可以将event画成一个点，而不是一个线段。**



例如，process 1内部有一个变量x=100，process 2内部有一个变量y=100。此时从整个分布式系统的角度看，x+y=200。

process1执行一个内部事件将x修改为80，然后它发送一个send event给process2，这个send event中包含一个消息，消息的值是20,process 2接受到这个事件之后取出20然后将自己内部的y修改为120.此时，x+y依然是200。

# 3.时钟

如何生成序呢？使用时钟，clock。使用时钟为每一个事件标记一个事件戳timestamp，这个timestamp满足这个条件：如果一个事件发生在另外一个事件之前，那么这个事件的时间戳小于那个事件的事件戳。这个条件叫做clock condition。



具体的有lamport clock。vector clock。



因果关系很重要，如果对时间按照因果关系是一个很重要的问题。由于在分布式系统中没有一个全局的时间可以使用，

所以，我们只能使用逻辑时钟对每一个事件标记一个时间，然后通过时间的大小来对事件进行排序。



逻辑时钟是一个函数C:H-&gt;T，将H中的每一个事件e映射为T中的t。T是一个偏序集合。

如果C满足如下条件，那么就说C是满足consistency condition。

e-&gt;e`=>C(e)<C(e`\)

